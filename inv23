-- Services
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- Player
local player = Players.LocalPlayer

-- Function to safely inspect a value (recursive, with depth limit and cycle detection)
local inspectedTables = {}  -- To detect cycles
local function safeInspect(value, depth, maxDepth, prefix)
    depth = depth or 0
    maxDepth = maxDepth or 3  -- Increase for deeper inspection (e.g., 5)
    prefix = prefix or ""
    
    if depth > maxDepth then
        return prefix .. "[DEPTH LIMIT REACHED]"
    end
    
    local valueType = type(value)
    if valueType == "table" then
        -- Cycle detection
        if inspectedTables[value] then
            return prefix .. "[CYCLE DETECTED]"
        end
        inspectedTables[value] = true
        
        local count = 0
        for _ in pairs(value) do count = count + 1 end
        
        if count == 0 then
            return prefix .. "[EMPTY TABLE]"
        end
        
        local output = prefix .. "[TABLE: " .. count .. " items]\n"
        local itemCount = 0
        local largeTableWarn = (count > 10)
        if largeTableWarn then
            output = output .. prefix .. "‚ö†Ô∏è Large table (>10 items); showing first 10...\n"
        end
        
        for key, subValue in pairs(value) do
            itemCount = itemCount + 1
            if itemCount > 10 then break end  -- Limit per level
            
            local keyStr = tostring(key)
            local subPrefix = prefix .. "  "
            local valueStr
            if type(subValue) == "table" then
                valueStr = "\n" .. safeInspect(subValue, depth + 1, maxDepth, subPrefix)
            else
                valueStr = " = " .. tostring(subValue)
            end
            output = output .. subPrefix .. keyStr .. ":" .. valueStr .. "\n"
        end
        
        if count > 10 then
            output = output .. prefix .. "... and " .. (count - 10) .. " more items\n"
        end
        
        inspectedTables[value] = nil  -- Clean up for next table
        return output
    elseif valueType == "string" and #value > 50 then
        return prefix .. '"' .. string.sub(value, 1, 50) .. "...' (truncated)"
    else
        return prefix .. tostring(value)
    end
end

-- Function to inspect all manager categories deeply
local function inspectAllManagersDeeply()
    print("üîç DEEP INSPECTION OF ALL MANAGER CATEGORIES")
    print("=============================================")
    
    -- Safe module load (with WaitForChild for reliability)
    local clientModules = ReplicatedStorage:WaitForChild("ClientModules", 10)
    if not clientModules then
        warn("‚ùå ClientModules folder not found in ReplicatedStorage")
        return
    end
    
    local core = clientModules:WaitForChild("Core", 10)
    if not core then
        warn("‚ùå Core folder not found")
        return
    end
    
    local success, clientData = pcall(require, core:WaitForChild("ClientData"))
    if not success then
        warn("‚ùå Failed to load ClientData: " .. tostring(clientData))
        return
    end
    
    local success2, dataTable = pcall(clientData.get_data)
    if not success2 then
        warn("‚ùå Failed to get data: " .. tostring(dataTable))
        return
    end
    
    local playerData = dataTable[player.Name]
    if not playerData then
        print("‚ùå No data found for player: " .. player.Name)
        print("Available players: " .. table.concat(Object.keys(dataTable or {}), ", "))
        return
    end
    
    local managerCount = 0
    
    -- Find and inspect all categories with "manager" in the name
    for categoryName, categoryData in pairs(playerData) do
        if string.find(string.lower(categoryName), "manager") then
            managerCount = managerCount + 1
            print("\nüéØ " .. string.upper(categoryName) .. ":")
            print(" Type: " .. type(categoryData))
            print(" ---")
            
            if type(categoryData) == "table" then
                print(safeInspect(categoryData, 0, 3))  -- Deep inspect to depth 3
            else
                print(" Value: " .. safeInspect(categoryData, 0, 3))
            end
            print("\n" .. string.rep("=", 50))
        end
    end
    
    if managerCount == 0 then
        print("‚ùå No manager categories found")
        print("All categories:")
        for catName, _ in pairs(playerData) do
            print("  - " .. catName)
        end
    else
        print("\nüìä Total manager categories inspected: " .. managerCount)
        print("üí° Tip: Adjust 'maxDepth' in safeInspect for even deeper dives!")
    end
end

-- Run the function
inspectAllManagersDeeply()
