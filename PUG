-- PUG TAMER üê∂
-- Scans for winter_2025_yarn_beanie_bait and auto-tames

-- Services
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")

-- Player
local player = Players.LocalPlayer

-- Configuration
local BAIT_NAME = "winter_2025_yarn_beanie_bait"
local DOG_NAME = "Dog"

-- Wait for player
repeat task.wait() until player
print("üê∂ PUG TAMER v1.0 LOADED")

-- ========== INVENTORY SCANNER ==========
local function scanForBait()
    print("üîç Scanning for bait: " .. BAIT_NAME)
    
    local baitInfo = {
        found = false,
        id = nil,
        name = nil,
        amount = 0
    }
    
    -- Try to access inventory data
    local success, errorMsg = pcall(function()
        -- Try different possible paths to get inventory data
        local clientData
        local clientModules = ReplicatedStorage:FindFirstChild("ClientModules")
        
        if clientModules then
            -- Try to find Core module
            local core = clientModules:FindFirstChild("Core")
            if core then
                local clientDataModule = core:FindFirstChild("ClientData")
                if clientDataModule then
                    clientData = require(clientDataModule)
                end
            end
        end
        
        if not clientData then
            print("‚ö†Ô∏è Could not find ClientData module")
            return
        end
        
        -- Get player data (try different methods)
        local playerData
        if clientData.get then
            playerData = clientData.get(player.Name)
        elseif clientData.GetData then
            playerData = clientData.GetData(player.Name)
        elseif clientData.get_data then
            playerData = clientData.get_data()[player.Name]
        elseif type(clientData) == "function" then
            playerData = clientData()[player.Name]
        end
        
        if not playerData then
            print("‚ö†Ô∏è Could not get player data")
            return
        end
        
        -- Scan food inventory
        if playerData.inventory and playerData.inventory.food then
            print("üì¶ Scanning food inventory...")
            
            for foodId, foodData in pairs(playerData.inventory.food) do
                if foodData and foodData.id then
                    local itemName = tostring(foodData.id)
                    local amount = foodData.amount or 1
                    
                    -- Check if this is our bait (case-insensitive)
                    if string.lower(itemName) == string.lower(BAIT_NAME) then
                        baitInfo.found = true
                        baitInfo.id = foodId
                        baitInfo.name = itemName
                        baitInfo.amount = amount
                        
                        print("‚úÖ FOUND BAIT!")
                        print("   Name: " .. itemName)
                        print("   ID: " .. foodId)
                        print("   Amount: " .. amount)
                        break -- Found it, no need to continue
                    end
                end
            end
            
            if not baitInfo.found then
                print("‚ùå Bait not found in inventory")
                print("   Looking for: " .. BAIT_NAME)
                
                -- List what WAS found
                local foodCount = 0
                for foodId, foodData in pairs(playerData.inventory.food) do
                    if foodData and foodData.id then
                        foodCount = foodCount + 1
                        if foodCount <= 5 then -- Show first 5 items
                            print("   Found: " .. foodData.id .. " (ID: " .. foodId .. ")")
                        end
                    end
                end
                if foodCount > 5 then
                    print("   ... and " .. (foodCount - 5) .. " more items")
                end
            end
        else
            print("‚ùå No food inventory found")
        end
    end)
    
    if not success then
        print("‚ö†Ô∏è Scan error: " .. tostring(errorMsg))
    end
    
    return baitInfo
end

-- ========== FIND CORRECT BAIT ID ==========
local function getBaitId()
    print("üéØ Getting correct bait ID...")
    
    local baitInfo = scanForBait()
    
    if not baitInfo.found then
        print("‚ùå Cannot find bait: " .. BAIT_NAME)
        return nil
    end
    
    print("üéØ Using bait ID: " .. baitInfo.id)
    return baitInfo.id
end

-- ========== API HELPER ==========
local function callAPI(apiPath, isInvoke, ...)
    local args = {...}
    
    -- Find the API
    local api = ReplicatedStorage
    local parts = string.split(apiPath, "/")
    
    for _, part in ipairs(parts) do
        api = api:WaitForChild(part, 1)
        if not api then
            print("‚ùå API not found: " .. part .. " in " .. apiPath)
            return false
        end
    end
    
    -- Call the API
    local success, result = pcall(function()
        if isInvoke then
            return api:InvokeServer(unpack(args))
        else
            return api:FireServer(unpack(args))
        end
    end)
    
    if not success then
        print("‚ö†Ô∏è API call failed (" .. apiPath .. "): " .. tostring(result))
        return false
    end
    
    return true
end

-- ========== PUG TAMING SEQUENCE ==========
local function tamePug()
    print("üê∂ STARTING PUG TAMING SEQUENCE")
    print("=" .. string.rep("=", 40))
    
    -- Step 1: Get the CORRECT bait ID from inventory
    local baitId = getBaitId()
    if not baitId then
        print("‚ùå Cannot proceed: No bait ID found")
        return false
    end
    
    print("üéØ Using bait ID: " .. baitId)
    
    -- Step 2: Find the dog
    local dog = Workspace:WaitForChild("Pets"):WaitForChild(DOG_NAME, 2)
    if not dog then
        print("‚ùå Dog not found in workspace")
        return false
    end
    print("üêï Found dog: " .. dog.Name)
    
    -- Step 3: Equip bait (using the CORRECT ID)
    print("1Ô∏è‚É£ Equipping bait...")
    local success1 = callAPI("API/ToolAPI/Equip", true, baitId, {
        use_sound_delay = false,
        equip_as_last = false
    })
    
    if not success1 then
        print("‚ùå Failed to equip bait")
        return false
    end
    task.wait(0.5)
    
    -- Step 4: Focus on dog
    print("2Ô∏è‚É£ Focusing on dog...")
    local success2 = callAPI("API/AdoptAPI/FocusPet", false, dog)
    if not success2 then
        print("‚ö†Ô∏è Could not focus dog, continuing...")
    end
    task.wait(1)
    
    -- Step 5: Start using bait (using the CORRECT ID)
    print("3Ô∏è‚É£ Starting bait use...")
    local success3 = callAPI("API/ToolAPI/ServerUseTool", false, baitId, "START")
    if not success3 then
        print("‚ùå Failed to start using bait")
        return false
    end
    task.wait(2)
    
    -- Step 6: End using bait (using the CORRECT ID)
    print("4Ô∏è‚É£ Ending bait use...")
    local success4 = callAPI("API/ToolAPI/ServerUseTool", false, baitId, "END")
    if not success4 then
        print("‚ùå Failed to end using bait")
        return false
    end
    task.wait(0.5)
    
    -- Step 7: Unfocus dog
    print("5Ô∏è‚É£ Unfocusing dog...")
    local success5 = callAPI("API/AdoptAPI/UnfocusPet", false, dog)
    if not success5 then
        print("‚ö†Ô∏è Could not unfocus dog, continuing...")
    end
    task.wait(0.5)
    
    -- Step 8: Progress taming
    print("6Ô∏è‚É£ Progressing taming...")
    local success6 = callAPI("API/WinterEventAPI/ProgressTaming", true, false)
    if not success6 then
        print("‚ùå Failed to progress taming")
        return false
    end
    
    print("‚úÖ PUG TAMING SEQUENCE COMPLETED!")
    print("=" .. string.rep("=", 40))
    
    return true
end

-- ========== QUICK TEST FUNCTION ==========
local function quickTest()
    print("üß™ QUICK TEST: Finding bait...")
    
    -- Just scan for bait to see what IDs we have
    local baitInfo = scanForBait()
    
    if baitInfo.found then
        print("\n‚úÖ Test passed!")
        print("Bait found: " .. baitInfo.name)
        print("Bait ID: " .. baitInfo.id)
        print("Amount: " .. baitInfo.amount)
        
        -- Test the ID
        print("\nüß™ Testing bait ID: " .. baitInfo.id)
        local success = callAPI("API/ToolAPI/Equip", true, baitInfo.id, {
            use_sound_delay = false,
            equip_as_last = false
        })
        
        if success then
            print("‚úÖ ID works! Can equip bait.")
            -- Unequip it
            task.wait(0.5)
            callAPI("API/ToolAPI/Unequip", true, baitInfo.id, {
                use_sound_delay = false,
                equip_as_last = false
            })
        else
            print("‚ùå ID doesn't work.")
        end
    else
        print("‚ùå Test failed: No bait found")
    end
end

-- ========== SIMPLE GUI ==========
local function createGUI()
    if not player:FindFirstChild("PlayerGui") then
        player:WaitForChild("PlayerGui", 5)
    end
    
    if not player.PlayerGui then return end
    
    -- Remove existing GUI
    local existing = player.PlayerGui:FindFirstChild("PugTamerGUI")
    if existing then existing:Destroy() end
    
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "PugTamerGUI"
    screenGui.Parent = player.PlayerGui
    
    -- Main Frame
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(0, 220, 0, 240)
    frame.Position = UDim2.new(0, 10, 0, 10)
    frame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    frame.BorderSizePixel = 0
    frame.Parent = screenGui
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 8)
    corner.Parent = frame
    
    -- Title
    local title = Instance.new("TextLabel")
    title.Size = UDim2.new(1, 0, 0, 40)
    title.BackgroundColor3 = Color3.fromRGB(60, 60, 70)
    title.Text = "üê∂ SMART PUG TAMER"
    title.TextColor3 = Color3.fromRGB(255, 255, 255)
    title.TextSize = 18
    title.Font = Enum.Font.SourceSansBold
    title.Parent = frame
    
    -- Status
    local status = Instance.new("TextLabel")
    status.Size = UDim2.new(1, 0, 0, 40)
    status.Position = UDim2.new(0, 0, 0.18, 0)
    status.BackgroundTransparency = 1
    status.Text = "Finds correct bait ID"
    status.TextColor3 = Color3.fromRGB(200, 200, 255)
    status.TextSize = 12
    status.TextWrapped = true
    status.Parent = frame
    
    -- Bait ID Display
    local idLabel = Instance.new("TextLabel")
    idLabel.Size = UDim2.new(1, 0, 0, 30)
    idLabel.Position = UDim2.new(0, 0, 0.35, 0)
    idLabel.BackgroundTransparency = 1
    idLabel.Text = "Bait ID: Not scanned"
    idLabel.TextColor3 = Color3.fromRGB(255, 200, 100)
    idLabel.TextSize = 11
    idLabel.TextWrapped = true
    idLabel.Parent = frame
    
    -- Update ID display function
    local function updateIdDisplay()
        local baitInfo = scanForBait()
        if baitInfo.found then
            idLabel.Text = "Bait ID: " .. string.sub(baitInfo.id, 1, 15) .. "..."
            status.Text = "‚úÖ Found: " .. baitInfo.name
        else
            idLabel.Text = "Bait ID: Not found"
            status.Text = "‚ùå No bait found"
        end
    end
    
    -- Buttons
    local function createButton(name, position, color, text)
        local btn = Instance.new("TextButton")
        btn.Size = UDim2.new(0.9, 0, 0, 35)
        btn.Position = position
        btn.BackgroundColor3 = color
        btn.Text = text
        btn.TextColor3 = Color3.fromRGB(255, 255, 255)
        btn.TextSize = 14
        btn.Font = Enum.Font.SourceSansBold
        btn.BorderSizePixel = 0
        btn.Parent = frame
        
        local btnCorner = Instance.new("UICorner")
        btnCorner.CornerRadius = UDim.new(0, 6)
        btnCorner.Parent = btn
        
        return btn
    end
    
    -- Scan Button
    local scanBtn = createButton("ScanBtn", UDim2.new(0.05, 0, 0.52, 0), 
        Color3.fromRGB(0, 120, 215), "SCAN BAIT")
    
    -- Test Button
    local testBtn = createButton("TestBtn", UDim2.new(0.05, 0, 0.67, 0), 
        Color3.fromRGB(100, 100, 200), "TEST BAIT ID")
    
    -- Tame Button
    local tameBtn = createButton("TameBtn", UDim2.new(0.05, 0, 0.82, 0), 
        Color3.fromRGB(215, 80, 0), "TAME PUG")
    
    -- Button Actions
    scanBtn.MouseButton1Click:Connect(function()
        scanBtn.Text = "SCANNING..."
        scanBtn.BackgroundColor3 = Color3.fromRGB(0, 150, 255)
        
        updateIdDisplay()
        
        task.wait(0.5)
        scanBtn.Text = "SCAN BAIT"
        scanBtn.BackgroundColor3 = Color3.fromRGB(0, 120, 215)
    end)
    
    testBtn.MouseButton1Click:Connect(function()
        testBtn.Text = "TESTING..."
        testBtn.BackgroundColor3 = Color3.fromRGB(150, 150, 255)
        
        quickTest()
        
        task.wait(0.5)
        testBtn.Text = "TEST BAIT ID"
        testBtn.BackgroundColor3 = Color3.fromRGB(100, 100, 200)
    end)
    
    tameBtn.MouseButton1Click:Connect(function()
        tameBtn.Text = "TAMING..."
        tameBtn.BackgroundColor3 = Color3.fromRGB(180, 60, 0)
        
        if tamePug() then
            status.Text = "Success! Taming completed"
            tameBtn.Text = "SUCCESS!"
            task.wait(1)
        else
            status.Text = "Taming failed"
            tameBtn.Text = "FAILED!"
            tameBtn.BackgroundColor3 = Color3.fromRGB(200, 0, 0)
            task.wait(1)
        end
        
        tameBtn.Text = "TAME PUG"
        tameBtn.BackgroundColor3 = Color3.fromRGB(215, 80, 0)
        updateIdDisplay()
    end)
    
    -- Initial scan
    task.wait(0.5)
    updateIdDisplay()
    
    print("‚úÖ GUI Created")
    return screenGui
end

-- ========== INITIALIZATION ==========
print("=" .. string.rep("=", 50))
print("üê∂ SMART PUG TAMER v2.0")
print("Finds CORRECT bait ID from inventory")
print("Target Bait: " .. BAIT_NAME)
print("=" .. string.rep("=", 50))

-- Wait a bit for game to load
task.wait(2)

-- Create GUI
createGUI()

print("\n‚úÖ SYSTEM READY!")
print("Commands:")
print("1. scanForBait() - Find bait and its ID")
print("2. getBaitId() - Get the correct bait ID")
print("3. tamePug() - Tame using correct ID")
print("4. quickTest() - Test bait ID works")
print("=" .. string.rep("=", 50))
