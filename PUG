-- PUG üê∂ WINTER BAIT TAMER
-- Services
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- Player
local player = Players.LocalPlayer

-- Config
local TARGET_BAIT = "winter_2025_yarn_beanie_bait"
local USE_SOUND_DELAY = false
local EQUIP_AS_LAST = false

-- Debug print with emoji
local function pugPrint(message)
    local timestamp = os.date("%H:%M:%S")
    print("üê∂ [" .. timestamp .. "] " .. message)
end

-- Scan food inventory for winter bait
local function scanForBait()
    pugPrint("üîç Scanning inventory for: " .. TARGET_BAIT)
    
    local foundBaitId = nil
    local baitCount = 0
    
    -- Try to access inventory data
    local success, errorMsg = pcall(function()
        -- Try different ways to get client data
        local clientData
        
        -- Method 1: Direct require
        if ReplicatedStorage:FindFirstChild("ClientModules") then
            local modules = ReplicatedStorage.ClientModules
            if modules:FindFirstChild("Core") and modules.Core:FindFirstChild("ClientData") then
                clientData = require(modules.Core.ClientData)
            end
        end
        
        -- Method 2: Try another path
        if not clientData and ReplicatedStorage:FindFirstChild("ClientModules") then
            local success2, data = pcall(function()
                return require(ReplicatedStorage.ClientModules)
            end)
            if success2 and data.Core and data.Core.ClientData then
                clientData = data.Core.ClientData
            end
        end
        
        if not clientData then
            pugPrint("‚ùå Could not find ClientData")
            return
        end
        
        -- Try to get player data
        local playerData
        if clientData.get then
            playerData = clientData.get(player.Name)
        elseif clientData.GetData then
            playerData = clientData.GetData(player.Name)
        elseif clientData.get_data then
            playerData = clientData.get_data()[player.Name]
        elseif type(clientData) == "function" then
            playerData = clientData()[player.Name]
        end
        
        if playerData and playerData.inventory and playerData.inventory.food then
            pugPrint("üì¶ Food inventory found, scanning...")
            
            for foodId, foodData in pairs(playerData.inventory.food) do
                if foodData and foodData.id then
                    local foodName = tostring(foodData.id)
                    local amount = foodData.amount or 1
                    
                    -- Check if it's our winter bait
                    if string.lower(foodName) == string.lower(TARGET_BAIT) then
                        foundBaitId = foodId
                        baitCount = amount
                        pugPrint("üéØ FOUND: " .. TARGET_BAIT)
                        pugPrint("   ID: " .. foodId)
                        pugPrint("   Amount: " .. amount)
                        break
                    end
                end
            end
            
            if not foundBaitId then
                pugPrint("‚ùå " .. TARGET_BAIT .. " not found in inventory")
                pugPrint("   Showing all food items:")
                
                for foodId, foodData in pairs(playerData.inventory.food) do
                    if foodData and foodData.id then
                        local foodName = tostring(foodData.id)
                        local amount = foodData.amount or 1
                        pugPrint("   - " .. foodName .. " (x" .. amount .. ")")
                    end
                end
            end
        else
            pugPrint("‚ùå No food inventory found")
        end
    end)
    
    if not success then
        pugPrint("‚ùå Error scanning inventory: " .. tostring(errorMsg))
    end
    
    return foundBaitId, baitCount
end

-- Find bait in inventory and return its ID
local function getBaitId()
    pugPrint("üîÑ Looking for bait ID...")
    
    -- First try to scan inventory
    local baitId, baitCount = scanForBait()
    
    if baitId then
        return baitId
    end
    
    -- If scan didn't find it, try the hardcoded ID
    pugPrint("‚ö†Ô∏è Could not find bait via scan, trying hardcoded ID...")
    return "2_8960019fe5ac437982d56ab8c54698e3"
end

-- Execute the exact taming sequence
local function executeTamingSequence()
    pugPrint("üöÄ STARTING WINTER TAMING SEQUENCE")
    
    -- Get bait ID
    local baitId = getBaitId()
    pugPrint("üéØ Using bait ID: " .. baitId)
    
    -- Step 1: Equip the bait
    pugPrint("1Ô∏è‚É£ Equipping bait...")
    local success1, error1 = pcall(function()
        local args = {
            baitId,
            {
                use_sound_delay = USE_SOUND_DELAY,
                equip_as_last = EQUIP_AS_LAST
            }
        }
        game:GetService("ReplicatedStorage"):WaitForChild("API"):WaitForChild("ToolAPI/Equip"):InvokeServer(unpack(args))
    end)
    
    if not success1 then
        pugPrint("‚ùå Failed to equip bait: " .. tostring(error1))
        return false
    end
    
    pugPrint("‚úÖ Bait equipped")
    wait(1)
    
    -- Step 2: Start using tool
    pugPrint("2Ô∏è‚É£ Starting bait use...")
    local success2, error2 = pcall(function()
        local args = {
            baitId,
            "START"
        }
        game:GetService("ReplicatedStorage"):WaitForChild("API"):WaitForChild("ToolAPI/ServerUseTool"):FireServer(unpack(args))
    end)
    
    if not success2 then
        pugPrint("‚ùå Failed to start bait: " .. tostring(error2))
        return false
    end
    
    pugPrint("‚è≥ Waiting 9 seconds...")
    wait(9)
    
    -- Step 3: End using tool
    pugPrint("3Ô∏è‚É£ Ending bait use...")
    local success3, error3 = pcall(function()
        local args = {
            baitId,
            "END"
        }
        game:GetService("ReplicatedStorage"):WaitForChild("API"):WaitForChild("ToolAPI/ServerUseTool"):FireServer(unpack(args))
    end)
    
    if not success3 then
        pugPrint("‚ùå Failed to end bait: " .. tostring(error3))
        return false
    end
    
    pugPrint("‚úÖ Bait use completed")
    wait(1)
    
    -- Step 4: Progress taming
    pugPrint("4Ô∏è‚É£ Progressing taming...")
    local success4, error4 = pcall(function()
        local args = { false }
        game:GetService("ReplicatedStorage"):WaitForChild("API"):WaitForChild("WinterEventAPI/ProgressTaming"):InvokeServer(unpack(args))
    end)
    
    if not success4 then
        pugPrint("‚ùå Failed to progress taming: " .. tostring(error4))
        
        -- Try alternative API name
        pugPrint("üîÑ Trying alternative API...")
        local success5, error5 = pcall(function()
            local args = { false }
            game:GetService("ReplicatedStorage"):WaitForChild("API"):WaitForChild("EventAPI/ProgressTaming"):InvokeServer(unpack(args))
        end)
        
        if success5 then
            pugPrint("‚úÖ Taming progressed via alternative API")
            return true
        else
            pugPrint("‚ùå Alternative API also failed: " .. tostring(error5))
            return false
        end
    end
    
    pugPrint("‚úÖ Taming progressed successfully!")
    return true
end

-- Create simple PUG UI
local function createPugUI()
    -- Wait for PlayerGui
    if not player:FindFirstChild("PlayerGui") then
        player:WaitForChild("PlayerGui", 5)
    end
    
    if not player.PlayerGui then return end
    
    -- Remove old UI if exists
    local oldUI = player.PlayerGui:FindFirstChild("PugTamerUI")
    if oldUI then
        oldUI:Destroy()
    end
    
    -- Create new UI
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "PugTamerUI"
    screenGui.ResetOnSpawn = false
    screenGui.Parent = player.PlayerGui
    
    -- Main frame
    local mainFrame = Instance.new("Frame")
    mainFrame.Size = UDim2.new(0, 200, 0, 140)
    mainFrame.Position = UDim2.new(0, 20, 0, 20)
    mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
    mainFrame.BackgroundTransparency = 0.1
    mainFrame.BorderSizePixel = 0
    mainFrame.Parent = screenGui
    
    -- Corner
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 8)
    corner.Parent = mainFrame
    
    -- Title
    local title = Instance.new("TextLabel")
    title.Size = UDim2.new(1, 0, 0, 30)
    title.BackgroundTransparency = 1
    title.Text = "üê∂ PUG TAMER"
    title.TextColor3 = Color3.fromRGB(255, 200, 100)
    title.TextSize = 16
    title.Font = Enum.Font.GothamBold
    title.Parent = mainFrame
    
    -- Status
    local status = Instance.new("TextLabel")
    status.Size = UDim2.new(1, 0, 0, 20)
    status.Position = UDim2.new(0, 0, 0.25, 0)
    status.BackgroundTransparency = 1
    status.Text = "Status: Ready"
    status.TextColor3 = Color3.fromRGB(150, 255, 150)
    status.TextSize = 12
    status.Font = Enum.Font.Gotham
    status.Parent = mainFrame
    
    -- Scan button
    local scanBtn = Instance.new("TextButton")
    scanBtn.Size = UDim2.new(0.9, 0, 0, 30)
    scanBtn.Position = UDim2.new(0.05, 0, 0.45, 0)
    scanBtn.BackgroundColor3 = Color3.fromRGB(70, 130, 200)
    scanBtn.Text = "üîç SCAN BAIT"
    scanBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    scanBtn.TextSize = 13
    scanBtn.Font = Enum.Font.GothamBold
    scanBtn.Parent = mainFrame
    
    -- Tame button
    local tameBtn = Instance.new("TextButton")
    tameBtn.Size = UDim2.new(0.9, 0, 0, 30)
    tameBtn.Position = UDim2.new(0.05, 0, 0.75, 0)
    tameBtn.BackgroundColor3 = Color3.fromRGB(200, 100, 50)
    tameBtn.Text = "üéØ AUTO-TAME"
    tameBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    tameBtn.TextSize = 13
    tameBtn.Font = Enum.Font.GothamBold
    tameBtn.Parent = mainFrame
    
    -- Button corners
    for _, btn in pairs({scanBtn, tameBtn}) do
        local btnCorner = Instance.new("UICorner")
        btnCorner.CornerRadius = UDim.new(0, 6)
        btnCorner.Parent = btn
    end
    
    -- Button actions
    scanBtn.MouseButton1Click:Connect(function()
        status.Text = "Status: Scanning..."
        scanForBait()
        status.Text = "Status: Scan Complete"
    end)
    
    tameBtn.MouseButton1Click:Connect(function()
        status.Text = "Status: Taming..."
        tameBtn.Text = "‚è≥ TAMING..."
        tameBtn.BackgroundColor3 = Color3.fromRGB(150, 80, 30)
        
        local success = executeTamingSequence()
        
        if success then
            status.Text = "Status: Success! üéâ"
            tameBtn.Text = "‚úÖ DONE!"
            tameBtn.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
            wait(2)
            tameBtn.Text = "üéØ AUTO-TAME"
            tameBtn.BackgroundColor3 = Color3.fromRGB(200, 100, 50)
            status.Text = "Status: Ready"
        else
            status.Text = "Status: Failed üò¢"
            tameBtn.Text = "‚ùå FAILED"
            tameBtn.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
            wait(2)
            tameBtn.Text = "üéØ AUTO-TAME"
            tameBtn.BackgroundColor3 = Color3.fromRGB(200, 100, 50)
            status.Text = "Status: Ready"
        end
    end)
    
    pugPrint("UI created! Check top-left corner üê∂")
end

-- Auto-run sequence
local function autoRun()
    pugPrint("========================================")
    pugPrint("      PUG üê∂ WINTER TAMER v1.0")
    pugPrint("========================================")
    
    -- Initial scan
    wait(2)
    scanForBait()
    
    -- Create UI
    wait(1)
    createPugUI()
    
    pugPrint("System ready! Use UI buttons to scan/tame")
    pugPrint("========================================")
    
    -- Optional: Auto-start taming after 5 seconds
    -- wait(5)
    -- executeTamingSequence()
end

-- Start everything
coroutine.wrap(autoRun)()
