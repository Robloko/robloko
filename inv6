local function inspectPetPenSlots()
    -- Wait for ClientModules and ClientData
    local ClientModules
    repeat
        ClientModules = game:GetService("ReplicatedStorage"):FindFirstChild("ClientModules")
        task.wait(1)
    until ClientModules
    
    local ClientData = require(ClientModules:WaitForChild("Core"):WaitForChild("ClientData"))
    local player = game.Players.LocalPlayer

    -- Wait for player data and idle_progression_manager
    local data
    repeat
        local success, result = pcall(function()
            return ClientData.get_data()[player.Name]
        end)
        if success and result then
            data = result
        end
        task.wait(1)
    until data and data.idle_progression_manager

    local manager = data.idle_progression_manager
    print("Dumping idle_progression_manager:")

    -- Check active_pets with the correct structure
    local petPenSlots = {}
    
    if manager.active_pets and typeof(manager.active_pets) == "table" then
        print("\nFound active_pets table (dictionary structure):")
        
        -- Convert to array for easier processing
        local slotIndex = 1
        for petUnique, petData in pairs(manager.active_pets) do
            print(string.format("Slot %d - Pet Unique: %s", slotIndex, petUnique))
            print(string.format("  Pet Data Type: %s", typeof(petData)))
            
            if typeof(petData) == "table" then
                -- Try to get pet info directly from active_pets table
                local petName = petData.id or petData.name or "Unknown"
                local age = petData.age or petData.properties and petData.properties.age or 0
                local neon = petData.neon or (petData.properties and petData.properties.neon) or false
                
                table.insert(petPenSlots, {
                    slot = slotIndex,
                    name = petName,
                    age = age,
                    neon = neon,
                    unique = petUnique,
                    raw_data = petData
                })
                
                -- Also try to cross-reference with inventory
                if data.inventory and data.inventory.pets and data.inventory.pets[petUnique] then
                    local inventoryPetData = data.inventory.pets[petUnique]
                    print(string.format("  Found in inventory: %s", inventoryPetData.id or "Unknown"))
                end
            end
            
            slotIndex = slotIndex + 1
        end
    end

    -- Print detailed pet information
    print("\nDETAILED PET PEN ANALYSIS:")
    for i, pet in ipairs(petPenSlots) do
        print(string.format("\nSlot %d:", i))
        print(string.format("  Unique ID: %s", pet.unique))
        print(string.format("  Name: %s", pet.name))
        print(string.format("  Age: %d", pet.age))
        print(string.format("  Neon: %s", tostring(pet.neon)))
        
        -- Dump all fields in the pet data
        if pet.raw_data then
            print("  All data fields:")
            for key, value in pairs(pet.raw_data) do
                if typeof(value) ~= "table" then
                    print(string.format("    %s: %s", key, tostring(value)))
                else
                    print(string.format("    %s: [table]", key))
                end
            end
        end
    end

    -- Summary display
    print("\nPETPEN SLOTS SUMMARY:")
    for i = 1, 4 do
        if petPenSlots[i] then
            local pet = petPenSlots[i]
            print(string.format("   [%d] %s | Age: %d | %s", 
                i, pet.name, pet.age, pet.neon and "NEON" or "normal"))
        else
            print(string.format("   [%d] EMPTY SLOT", i))
        end
    end
    
    return petPenSlots
end

-- Call the function
inspectPetPenSlots()
