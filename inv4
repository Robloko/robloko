-- FINAL INSPECT: idle_progression_manager (works on every server, no spam)
spawn(function()
    print("Waiting for idle_progression_manager to load... (this is normal)")

    local API = game:GetService("ReplicatedStorage"):WaitForChild("API")
    local IdleAPI = nil
    local lastPrint = tick()

    -- INFINITE WAIT + spam control (prints every 8 sec max)
    while not IdleAPI do
        IdleAPI = API:FindFirstChild("IdleProgressionAPI")
        if IdleAPI then break end
        if tick() - lastPrint > 8 then
            print("Still waiting for IdleProgressionAPI... ("..math.floor(tick() - lastPrint).."s)")
            lastPrint = tick()
        end
        task.wait(1)
    end

    print("IdleProgressionAPI FOUND! Now grabbing idle_progression_manager...")

    local clientData = require(ReplicatedStorage.ClientModules.Core.ClientData)
    local data = clientData.get_data()[player.Name]

    -- WAIT FOR idle_progression_manager (it appears 3â€“15 sec AFTER IdleAPI)
    local manager = nil
    lastPrint = tick()
    while not manager do
        manager = data.idle_progression_manager
        if manager then break end
        if tick() - lastPrint > 10 then
            print("Waiting for idle_progression_manager inside player data... ("..math.floor(tick() - lastPrint).."s)")
            lastPrint = tick()
        end
        task.wait(1)
        data = clientData.get_data()[player.Name]  -- refresh
    end

    print("idle_progression_manager LOADED! FULL INSPECT:")
    print("=================================================")

    for key, value in pairs(manager) do
        if typeof(value) == "table" then
            local count = 0
            for _ in pairs(value) do count += 1 end
            print("TABLE " .. key .. " [" .. count .. " entries]")
            for subKey, subValue in pairs(value) do
                if typeof(subValue) == "table" then
                    local subCount = 0
                    for _ in pairs(subValue) do subCount += 1 end
                    print("   TABLE " .. subKey .. " [" .. subCount .. " entries]")
                else
                    print("   " .. subKey .. " = " .. tostring(subValue))
                end
            end
        else
            print(key .. " = " .. tostring(value))
        end
    end

    -- BONUS: Show current PetPen via GetPetPen
    local GetPetPen = IdleAPI:FindFirstChild("GetPetPen")
    if GetPetPen then
        local ok, res = pcall(function() return GetPetPen:InvokeServer() end)
        if ok and res and res.pets then
            print("\nCURRENT PETPEN ("..#res.pets.."/4):")
            for i, pet in ipairs(res.pets) do
                print(string.format("   [%d] %s | Age: %d | Neon: %s", 
                    i, pet.id or "??", pet.age or 0, pet.neon and "YES" or "NO"))
            end
        end
    end

    print("=================================================")
    print("idle_progression_manager INSPECT COMPLETE")
end)
