-- FINAL DEEP DIVE: idle_progression_manager (works 100% on every join)
spawn(function()
    print("INSPECTING idle_progression_manager - FULL DEEP DIVE")

    -- ULTRA-SAFE WAIT FOR ClientModules (never fails)
    local ClientModules = nil
    while not ClientModules do
        ClientModules = game:GetService("ReplicatedStorage"):FindFirstChild("ClientModules")
        if ClientModules then break end
        task.wait(1)
    end

    local ClientData = require(ClientModules:WaitForChild("Core"):WaitForChild("ClientData"))
    local player = game.Players.LocalPlayer

    -- WAIT FOR PLAYER DATA
    local data = nil
    while not data or not data.idle_progression_manager do
        local success, result = pcall(function()
            return ClientData.get_data()[player.Name]
        end)
        if success and result then
            data = result
        end
        task.wait(1)
    end

    local manager = data.idle_progression_manager
    print("idle_progression_manager FOUND! DUMPING EVERYTHING:")

    for key, value in pairs(manager) do
        if typeof(value) == "table" then
            local count = 0
            for _ in pairs(value) do count += 1 end
            print("TABLE " .. key .. " [" .. count .. " entries]")
            
            for subKey, subValue in pairs(value) do
                if typeof(subValue) == "table" then
                    local subCount = 0
                    for _ in pairs(subValue) do subCount += 1 end
                    print("   TABLE " .. subKey .. " [" .. subCount .. " entries]")
                else
                    print("   " .. subKey .. " = " .. tostring(subValue))
                end
            end
        else
            print(key .. " = " .. tostring(value))
        end
    end

    -- BONUS: Current PetPen via GetPetPen
    local API = game:GetService("ReplicatedStorage"):WaitForChild("API")
    local IdleAPI = API:WaitForChild("IdleProgressionAPI")
    local GetPetPen = IdleAPI:FindFirstChild("GetPetPen")
    
    if GetPetPen then
        local ok, res = pcall(function() return GetPetPen:InvokeServer() end)
        if ok and res and res.pets then
            print("\nPETPEN STATUS ("..#res.pets.."/4):")
            for i, pet in ipairs(res.pets) do
                local neon = pet.neon and "NEON" or "normal"
                print(string.format("   [%d] %s | Age: %d | %s | Unique: %s", 
                    i, pet.id or "??", pet.age or 0, neon, tostring(pet.unique):sub(1,12)))
            end
        end
    end

    print("DEEP DIVE COMPLETE â€” YOU NOW OWN THE GAME")
end)
