-- Services
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- Player
local player = Players.LocalPlayer

-- Function to deeply examine pet data structure for rarity
local function deeplyExaminePetRarity()
    local success, data = pcall(function()
        local clientData = require(ReplicatedStorage.ClientModules.Core.ClientData)
        local playerData = clientData.get_data()[player.Name]
        
        if playerData and playerData.inventory and playerData.inventory.pets then
            print("üéØ DEEP EXAMINATION OF PET DATA STRUCTURE:")
            
            -- Examine first pet in detail
            for petUniqueID, petData in pairs(playerData.inventory.pets) do
                print("")
                print("üîç DEEP EXAMINING PET: " .. tostring(petData.id))
                print("Unique ID: " .. tostring(petUniqueID))
                
                -- Function to recursively print table structure
                local function printTable(t, indent, maxDepth, currentDepth)
                    indent = indent or 0
                    currentDepth = currentDepth or 0
                    maxDepth = maxDepth or 3
                    
                    if currentDepth > maxDepth then
                        print(string.rep("  ", indent) .. "... (max depth reached)")
                        return
                    end
                    
                    for key, value in pairs(t) do
                        local indentStr = string.rep("  ", indent)
                        if type(value) == "table" then
                            print(indentStr .. key .. ": [TABLE]")
                            printTable(value, indent + 1, maxDepth, currentDepth + 1)
                        else
                            -- Highlight potential rarity fields
                            local displayValue = tostring(value)
                            if type(value) == "string" and (
                                string.find(string.lower(displayValue), "common") or
                                string.find(string.lower(displayValue), "uncommon") or
                                string.find(string.lower(displayValue), "rare") or
                                string.find(string.lower(displayValue), "legendary") or
                                string.find(string.lower(displayValue), "basic") or
                                string.find(string.lower(displayValue), "epic") or
                                string.find(string.lower(displayValue), "mythic")
                            ) then
                                displayValue = "üéâ " .. displayValue .. " üéâ"  -- Highlight potential rarity
                            end
                            
                            if key == "rarity" or key == "r" or key == "tier" then
                                displayValue = "üî• " .. displayValue .. " üî•"  -- Highlight rarity fields
                            end
                            
                            print(indentStr .. key .. ": " .. displayValue)
                        end
                    end
                end
                
                -- Print complete structure of the pet
                printTable(petData)
                break -- Only examine first pet
            end
        end
    end)
    
    if not success then
        print("‚ùå Error: " .. tostring(data))
    end
end

-- Function to search for rarity in all possible field names
local function searchAllRarityFields()
    local success, data = pcall(function()
        local clientData = require(ReplicatedStorage.ClientModules.Core.ClientData)
        local playerData = clientData.get_data()[player.Name]
        
        if playerData and playerData.inventory and playerData.inventory.pets then
            print("üîç SEARCHING ALL POSSIBLE RARITY FIELDS:")
            
            local possibleRarityFields = {
                "rarity", "r", "tier", "grade", "quality", "rank", "type", "kind",
                "category", "class", "level", "rarityType", "petRarity"
            }
            
            for petUniqueID, petData in pairs(playerData.inventory.pets) do
                print("")
                print("üêæ PET: " .. tostring(petData.id))
                
                local foundRarity = false
                
                -- Check all possible field names
                for _, fieldName in pairs(possibleRarityFields) do
                    if petData[fieldName] then
                        print("üéâ Found '" .. fieldName .. "' field: " .. tostring(petData[fieldName]))
                        foundRarity = true
                    end
                    
                    -- Check in properties table
                    if petData.properties and petData.properties[fieldName] then
                        print("üéâ Found 'properties." .. fieldName .. "' field: " .. tostring(petData.properties[fieldName]))
                        foundRarity = true
                    end
                end
                
                -- If no standard fields found, search all string values
                if not foundRarity then
                    print("üîé Searching all string values for rarity keywords...")
                    
                    local function searchStrings(t, prefix)
                        for key, value in pairs(t) do
                            if type(value) == "string" then
                                local lowerValue = string.lower(value)
                                if string.find(lowerValue, "common") or
                                   string.find(lowerValue, "uncommon") or
                                   string.find(lowerValue, "rare") or
                                   string.find(lowerValue, "legendary") or
                                   string.find(lowerValue, "basic") or
                                   string.find(lowerValue, "epic") or
                                   string.find(lowerValue, "mythic") or
                                   string.find(lowerValue, "ultra") then
                                    print("üéâ Found rarity keyword in '" .. prefix .. key .. "': " .. value)
                                    foundRarity = true
                                end
                            elseif type(value) == "table" then
                                searchStrings(value, prefix .. key .. ".")
                            end
                        end
                    end
                    
                    searchStrings(petData, "")
                end
                
                if not foundRarity then
                    print("‚ùå No rarity information found for this pet")
                end
                
                break -- Only check first pet
            end
        end
    end)
    
    if not success then
        print("‚ùå Error: " .. tostring(data))
    end
end

-- Function to check if rarity might be in the pet name or ID
local function checkNameForRarity()
    local success, data = pcall(function()
        local clientData = require(ReplicatedStorage.ClientModules.Core.ClientData)
        local playerData = clientData.get_data()[player.Name]
        
        if playerData and playerData.inventory and playerData.inventory.pets then
            print("üîç CHECKING PET NAMES FOR RARITY PATTERNS:")
            
            for petUniqueID, petData in pairs(playerData.inventory.pets) do
                local petName = tostring(petData.id)
                local lowerName = string.lower(petName)
                
                print("üêæ " .. petName)
                
                -- Check for rarity patterns in the name
                if string.find(lowerName, "legendary") then
                    print("   üéâ Rarity: Legendary (from name)")
                elseif string.find(lowerName, "epic") then
                    print("   üéâ Rarity: Epic (from name)")
                elseif string.find(lowerName, "rare") then
                    print("   üéâ Rarity: Rare (from name)")
                elseif string.find(lowerName, "uncommon") then
                    print("   üéâ Rarity: Uncommon (from name)")
                elseif string.find(lowerName, "common") then
                    print("   üéâ Rarity: Common (from name)")
                elseif string.find(lowerName, "basic") then
                    print("   üéâ Rarity: Basic (from name)")
                elseif string.find(lowerName, "mythic") then
                    print("   üéâ Rarity: Mythic (from name)")
                else
                    print("   ‚ùì Rarity: Unknown (no pattern in name)")
                end
            end
        end
    end)
    
    if not success then
        print("‚ùå Error: " .. tostring(data))
    end
end

-- Run all examination functions
deeplyExaminePetRarity()
searchAllRarityFields()
checkNameForRarity()
