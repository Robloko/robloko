-- Function to examine pet data structure and find rarity
local function examinePetDataStructure()
    debugPrint("ğŸ” EXAMINING PET DATA STRUCTURE...")
    
    local success, data = pcall(function()
        return require(ReplicatedStorage.ClientModules.Core.ClientData).get_data()[player.Name]
    end)
    
    if not success or not data then
        debugPrint("âŒ Failed to access player data")
        return
    end
    
    if not data.inventory or not data.inventory.pets then
        debugPrint("âŒ No pets found in inventory")
        return
    end

    debugPrint("ğŸ“Š Total pets in inventory: " .. table.count(data.inventory.pets))
    
    -- Examine first few pets to understand structure
    local examined = 0
    for petUniqueID, petData in pairs(data.inventory.pets) do
        examined = examined + 1
        if examined > 3 then break end -- Only examine first 3 pets
        
        debugPrint("")
        debugPrint("ğŸ¯ PET #" .. examined .. " ANALYSIS:")
        debugPrint("Pet Name: " .. tostring(petData.id))
        debugPrint("Unique ID: " .. tostring(petUniqueID))
        
        -- Print all top-level fields
        debugPrint("ğŸ“‹ Top-level fields:")
        for key, value in pairs(petData) do
            if type(value) == "table" then
                debugPrint("  " .. key .. " = [TABLE]")
                -- Print sub-fields if it's a table
                for subKey, subValue in pairs(value) do
                    debugPrint("    " .. subKey .. " = " .. tostring(subValue))
                end
            else
                debugPrint("  " .. key .. " = " .. tostring(value))
            end
        end
        
        -- Check for common rarity field names
        local potentialRarityFields = {}
        for key, value in pairs(petData) do
            if type(value) == "string" then
                local lowerValue = string.lower(value)
                if string.find(lowerValue, "common") or 
                   string.find(lowerValue, "uncommon") or 
                   string.find(lowerValue, "rare") or 
                   string.find(lowerValue, "legendary") then
                    table.insert(potentialRarityFields, {key = key, value = value})
                end
            end
        end
        
        if #potentialRarityFields > 0 then
            debugPrint("ğŸ‰ POTENTIAL RARITY FOUND:")
            for _, field in ipairs(potentialRarityFields) do
                debugPrint("  " .. field.key .. " = " .. field.value)
            end
        else
            debugPrint("âŒ No obvious rarity fields found")
        end
    end
end

-- Function to dump all fields of first pet for deep analysis
local function deepAnalyzePetStructure()
    debugPrint("ğŸ”¬ DEEP PET STRUCTURE ANALYSIS...")
    
    local success, data = pcall(function()
        return require(ReplicatedStorage.ClientModules.Core.ClientData).get_data()[player.Name]
    end)
    
    if not success or not data then
        debugPrint("âŒ Failed to access player data")
        return
    end
    
    if not data.inventory or not data.inventory.pets then
        debugPrint("âŒ No pets found in inventory")
        return
    end

    -- Get first pet
    for petUniqueID, petData in pairs(data.inventory.pets) do
        debugPrint("")
        debugPrint("ğŸ§¬ COMPLETE PET DATA DUMP:")
        debugPrint("Pet: " .. tostring(petData.id))
        
        local function dumpTable(t, indent)
            indent = indent or 0
            for key, value in pairs(t) do
                local indentStr = string.rep("  ", indent)
                if type(value) == "table" then
                    debugPrint(indentStr .. key .. ": [TABLE]")
                    dumpTable(value, indent + 1)
                else
                    debugPrint(indentStr .. key .. ": " .. tostring(value))
                end
            end
        end
        
        dumpTable(petData)
        break -- Only analyze first pet
    end
end

-- Function to try common rarity detection methods
local function findPetRarity(petData)
    if not petData then return "Unknown" end
    
    -- Method 1: Direct rarity field
    if petData.rarity then
        return tostring(petData.rarity)
    end
    
    -- Method 2: Properties.rarity
    if petData.properties and petData.properties.rarity then
        return tostring(petData.properties.rarity)
    end
    
    -- Method 3: s.rarity (common in some games)
    if petData.s and petData.s.rarity then
        return tostring(petData.s.rarity)
    end
    
    -- Method 4: r field
    if petData.r then
        return tostring(petData.r)
    end
    
    -- Method 5: Check all string fields for rarity keywords
    for key, value in pairs(petData) do
        if type(value) == "string" then
            local lowerValue = string.lower(value)
            if string.find(lowerValue, "common") then return "Common" end
            if string.find(lowerValue, "uncommon") then return "Uncommon" end
            if string.find(lowerValue, "rare") then return "Rare" end
            if string.find(lowerValue, "legendary") then return "Legendary" end
            if string.find(lowerValue, "ultra") then return "Ultra-Rare" end
            if string.find(lowerValue, "epic") then return "Epic" end
            if string.find(lowerValue, "mythic") then return "Mythic" end
        end
    end
    
    -- Method 6: Check properties table
    if petData.properties then
        for key, value in pairs(petData.properties) do
            if type(value) == "string" then
                local lowerValue = string.lower(value)
                if string.find(lowerValue, "common") then return "Common" end
                if string.find(lowerValue, "uncommon") then return "Uncommon" end
                if string.find(lowerValue, "rare") then return "Rare" end
                if string.find(lowerValue, "legendary") then return "Legendary" end
                if string.find(lowerValue, "ultra") then return "Ultra-Rare" end
                if string.find(lowerValue, "epic") then return "Epic" end
                if string.find(lowerValue, "mythic") then return "Mythic" end
            end
        end
    end
    
    return "Unknown"
end

-- Simple function to print pet rarities based on discovered structure
local function printPetRaritiesSimple()
    debugPrint("ğŸ¾ SIMPLE PET RARITY REPORT")
    debugPrint("==========================")
    
    local success, data = pcall(function()
        return require(ReplicatedStorage.ClientModules.Core.ClientData).get_data()[player.Name]
    end)
    
    if not success or not data then
        debugPrint("âŒ Failed to access player data")
        return
    end
    
    if not data.inventory or not data.inventory.pets then
        debugPrint("âŒ No pets found in inventory")
        return
    end

    local rarityCounts = {
        Common = 0,
        Uncommon = 0,
        Rare = 0,
        ["Ultra-Rare"] = 0,
        Legendary = 0,
        Epic = 0,
        Mythic = 0,
        Unknown = 0
    }
    
    local totalPets = 0
    
    debugPrint("ğŸ“‹ INDIVIDUAL PET RARITIES:")
    for petUniqueID, petData in pairs(data.inventory.pets) do
        totalPets = totalPets + 1
        local petName = petData.id or "Unknown"
        local rarity = findPetRarity(petData)
        
        -- Categorize the found rarity
        local lowerRarity = string.lower(rarity)
        local category = "Unknown"
        
        if string.find(lowerRarity, "common") then
            category = "Common"
        elseif string.find(lowerRarity, "uncommon") then
            category = "Uncommon"
        elseif string.find(lowerRarity, "rare") and not string.find(lowerRarity, "ultra") then
            category = "Rare"
        elseif string.find(lowerRarity, "ultra") then
            category = "Ultra-Rare"
        elseif string.find(lowerRarity, "legendary") then
            category = "Legendary"
        elseif string.find(lowerRarity, "epic") then
            category = "Epic"
        elseif string.find(lowerRarity, "mythic") then
            category = "Mythic"
        else
            category = "Unknown"
        end
        
        rarityCounts[category] = rarityCounts[category] + 1
        
        local neonStatus = ""
        if petData.properties then
            if petData.properties.mega_neon then
                neonStatus = " ğŸŒŸMEGA NEONğŸŒŸ"
            elseif petData.properties.neon then
                neonStatus = " âœ¨NEONâœ¨"
            end
        end
        
        debugPrint("  " .. petName .. " â†’ " .. rarity .. neonStatus)
    end
    
    -- Print summary
    debugPrint("")
    debugPrint("ğŸ“Š RARITY SUMMARY:")
    debugPrint("Total Pets: " .. totalPets)
    debugPrint("")
    
    local categories = {"Common", "Uncommon", "Rare", "Ultra-Rare", "Legendary", "Epic", "Mythic", "Unknown"}
    for _, category in ipairs(categories) do
        if rarityCounts[category] > 0 then
            local percentage = math.floor((rarityCounts[category] / totalPets) * 100)
            local emoji = "â“"
            if category == "Common" then emoji = "âšª"
            elseif category == "Uncommon" then emoji = "ğŸŸ¢"
            elseif category == "Rare" then emoji = "ğŸ”µ"
            elseif category == "Ultra-Rare" then emoji = "ğŸŸ£"
            elseif category == "Legendary" then emoji = "ğŸŸ¡"
            elseif category == "Epic" then emoji = "ğŸŸ "
            elseif category == "Mythic" then emoji = "ğŸ”´" end
            
            debugPrint(emoji .. " " .. category .. ": " .. rarityCounts[category] .. " (" .. percentage .. "%)")
        end
    end
end

-- Add these functions to your script and call them:

-- First, let's examine the data structure
examinePetDataStructure()

-- If that doesn't show clear rarity, do a deep analysis
-- deepAnalyzePetStructure()

-- Then try the simple rarity report
printPetRaritiesSimple()
