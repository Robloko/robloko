-- Load Rayfield UI Library
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

-- Create the main window
local Window = Rayfield:CreateWindow({
    Name = "Player Manager",
    LoadingTitle = "Loading Player Manager...",
    LoadingSubtitle = "by YourName",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "PlayerManager",
        FileName = "Config"
    },
    Discord = {
        Enabled = false,
        Invite = "noinvitelink",
        RememberJoins = true
    },
    KeySystem = false,
    KeySettings = {
        Title = "Untitled",
        Subtitle = "Key System",
        Note = "No method of obtaining the key is provided",
        FileName = "Key",
        SaveKey = true,
        GrabKeyFromSite = false,
        Key = {"Hello"}
    }
})

-- Create the main tab
local MainTab = Window:CreateTab("Players", 4483362458)

-- Variables
local playerNames = {"None"}
local selectedPlayer = "None"

-- Function to get player list
local function getPlayers()
    local players = {}
    for _, player in ipairs(game:GetService("Players"):GetPlayers()) do
        if player and player.Name then
            table.insert(players, player.Name)
        end
    end
    return players
end

-- Create the dropdown first with empty options
local PlayerDropdown = MainTab:CreateDropdown({
    Name = "Select Player",
    Options = playerNames,
    CurrentOption = "None",
    Flag = "PlayerDropdown",
    Callback = function(SelectedOption)
        selectedPlayer = SelectedOption
        print("Selected player:", selectedPlayer)
        Rayfield:Notify({
            Title = "Player Selected",
            Content = "Selected: " .. selectedPlayer,
            Duration = 2,
            Image = 4483362458
        })
    end,
})

-- Create the player list section
local PlayerSection = MainTab:CreateSection("Player List")

-- Function to update player list
local function UpdatePlayerList()
    local players = getPlayers()
    local newOptions = {"None"}
    
    -- Add all players to options
    for _, playerName in ipairs(players) do
        table.insert(newOptions, playerName)
    end
    
    -- Clear old options and add new ones
    PlayerDropdown.Options = newOptions
    
    -- Try different method names based on Rayfield version
    local success, errorMsg = pcall(function()
        PlayerDropdown:Set(newOptions) -- Try Set method
    end)
    
    if not success then
        success, errorMsg = pcall(function()
            PlayerDropdown:Refresh(newOptions) -- Try Refresh method
        end)
    end
    
    if not success then
        success, errorMsg = pcall(function()
            PlayerDropdown:Update(newOptions) -- Try Update method
        end)
    end
    
    -- If none work, recreate the dropdown
    if not success then
        PlayerDropdown = MainTab:CreateDropdown({
            Name = "Select Player",
            Options = newOptions,
            CurrentOption = "None",
            Flag = "PlayerDropdown2",
            Callback = function(SelectedOption)
                selectedPlayer = SelectedOption
                print("Selected player:", selectedPlayer)
            end,
        })
    end
    
    return #players
end

-- Button to refresh player list
MainTab:CreateButton({
    Name = "Refresh Player List",
    Callback = function()
        local playerCount = UpdatePlayerList()
        Rayfield:Notify({
            Title = "Player List Updated",
            Content = "Found " .. playerCount .. " players in server.",
            Duration = 3,
            Image = 4483362458
        })
    end,
})

-- Function to auto-update when players join/leave
local function SetupPlayerTracking()
    -- Update initially
    local initialCount = UpdatePlayerList()
    print("Initial player count:", initialCount)
    
    -- Update when player joins
    game:GetService("Players").PlayerAdded:Connect(function(player)
        task.wait(0.5)
        local count = UpdatePlayerList()
        print("Player joined:", player.Name, "Total:", count)
        
        Rayfield:Notify({
            Title = player.Name .. " joined",
            Content = "Total players: " .. count,
            Duration = 3,
            Image = 4483362458
        })
    end)
    
    -- Update when player leaves
    game:GetService("Players").PlayerRemoved:Connect(function(player)
        task.wait(0.5)
        local count = UpdatePlayerList()
        print("Player left:", player.Name, "Total:", count)
        
        Rayfield:Notify({
            Title = player.Name .. " left",
            Content = "Total players: " .. count,
            Duration = 3,
            Image = 4483362458
        })
    end)
end

-- Create some example player actions
local ActionsSection = MainTab:CreateSection("Player Actions")

-- Example: Teleport to player
MainTab:CreateButton({
    Name = "Teleport to Selected Player",
    Callback = function()
        if selectedPlayer and selectedPlayer ~= "None" then
            local target = game:GetService("Players"):FindFirstChild(selectedPlayer)
            if target and target.Character and target.Character:FindFirstChild("HumanoidRootPart") then
                local localPlayer = game:GetService("Players").LocalPlayer
                if localPlayer.Character and localPlayer.Character:FindFirstChild("HumanoidRootPart") then
                    localPlayer.Character.HumanoidRootPart.CFrame = target.Character.HumanoidRootPart.CFrame
                    Rayfield:Notify({
                        Title = "Teleported",
                        Content = "Teleported to " .. selectedPlayer,
                        Duration = 3,
                        Image = 4483362458
                    })
                else
                    Rayfield:Notify({
                        Title = "Error",
                        Content = "Your character doesn't exist!",
                        Duration = 3,
                        Image = 4483362458
                    })
                end
            else
                Rayfield:Notify({
                    Title = "Error",
                    Content = selectedPlayer .. " not found or doesn't have character!",
                    Duration = 3,
                    Image = 4483362458
                })
            end
        else
            Rayfield:Notify({
                Title = "No Player Selected",
                Content = "Please select a player first.",
                Duration = 3,
                Image = 4483362458
            })
        end
    end,
})

-- Example: View player info
MainTab:CreateButton({
    Name = "Show Player Info",
    Callback = function()
        if selectedPlayer and selectedPlayer ~= "None" then
            local target = game:GetService("Players"):FindFirstChild(selectedPlayer)
            if target then
                Rayfield:Notify({
                    Title = "Player Info: " .. selectedPlayer,
                    Content = "UserID: " .. target.UserId .. 
                             "\nAccount Age: " .. target.AccountAge .. " days" ..
                             "\nDisplay Name: " .. target.DisplayName,
                    Duration = 5,
                    Image = 4483362458
                })
            else
                Rayfield:Notify({
                    Title = "Error",
                    Content = "Player not found!",
                    Duration = 3,
                    Image = 4483362458
                })
            end
        else
            Rayfield:Notify({
                Title = "No Player Selected",
                Content = "Please select a player first.",
                Duration = 3,
                Image = 4483362458
            })
        end
    end,
})

-- Debug button to check current players
MainTab:CreateButton({
    Name = "Debug: Check Players",
    Callback = function()
        local players = getPlayers()
        local playerList = ""
        for i, name in ipairs(players) do
            playerList = playerList .. i .. ". " .. name .. "\n"
        end
        
        if #players == 0 then
            playerList = "No players found (except you)"
        end
        
        Rayfield:Notify({
            Title = "Debug: Player List",
            Content = "Players in server:\n" .. playerList,
            Duration = 6,
            Image = 4483362458
        })
        
        print("DEBUG - Players in game:")
        for _, player in ipairs(game:GetService("Players"):GetPlayers()) do
            print("  - " .. player.Name .. " (UserId: " .. player.UserId .. ")")
        end
    end,
})

-- Start tracking players
task.spawn(function()
    task.wait(1) -- Wait a bit for UI to load
    SetupPlayerTracking()
end)

-- Initialize the UI
task.wait(0.5)
Rayfield:Notify({
    Title = "Player Manager Loaded",
    Content = "Select a player from the dropdown to begin.",
    Duration = 5,
    Image = 4483362458
})

print("Player Manager UI Loaded Successfully!")
