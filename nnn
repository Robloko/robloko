-- Load Rayfield UI Library
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

-- Create the main window
local Window = Rayfield:CreateWindow({
    Name = "Player List",
    LoadingTitle = "Loading Player Manager...",
    LoadingSubtitle = "Auto-Refresh Player List",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "PlayerList",
        FileName = "Config"
    },
    KeySystem = false,
})

-- Variables
local selectedPlayer = "None"

-- Create the Players tab with a custom icon
local PlayersTab = Window:CreateTab("Players", 12549490297) -- Player icon ID

-- Function to get all player names from server
local function getAllPlayerNames()
    local names = {}
    local players = game.Players:GetPlayers()
    
    for _, player in ipairs(players) do
        table.insert(names, player.Name)
    end
    
    return names
end

-- Create the dropdown
local PlayerDropdown = PlayersTab:CreateDropdown({
    Name = "Server Players",
    Options = getAllPlayerNames(),
    CurrentOption = {"Select a player"},
    MultipleOptions = false,
    Flag = "ServerPlayersDropdown",
    Callback = function(Option)
        selectedPlayer = Option[1]
        print("Selected player:", selectedPlayer)
    end,
})

-- Create a section for the dropdown
PlayersTab:CreateSection("Active Players on Server")

-- Function to update the player list
local function updatePlayerList()
    local playerNames = getAllPlayerNames()
    
    if #playerNames > 0 then
        PlayerDropdown:Refresh(playerNames)
        print("Player list updated. Total players:", #playerNames)
    else
        PlayerDropdown:Refresh({"No players found"})
        print("No players found in server")
    end
end

-- Auto-refresh functionality
local function setupAutoRefresh()
    -- Initial update
    updatePlayerList()
    
    -- Update when player joins
    game.Players.PlayerAdded:Connect(function(player)
        task.wait(0.5)
        updatePlayerList()
        print("Player joined:", player.Name)
    end)
    
    -- Update when player leaves
    game.Players.PlayerRemoved:Connect(function(player)
        task.wait(0.5)
        updatePlayerList()
        
        -- Reset selection if selected player left
        if selectedPlayer == player.Name then
            PlayerDropdown:Set({"Select a player"})
            selectedPlayer = "None"
        end
        
        print("Player left:", player.Name)
    end)
end

-- Start auto-refresh
setupAutoRefresh()

-- Simple refresh button as fallback
PlayersTab:CreateButton({
    Name = "Manual Refresh",
    Callback = function()
        updatePlayerList()
        Rayfield:Notify({
            Title = "Refreshed",
            Content = "Player list updated",
            Duration = 1.5,
        })
    end,
})

-- Notification when loaded
Rayfield:Notify({
    Title = "Player List Active",
    Content = "Auto-refresh enabled for server players",
    Duration = 3,
})

print("Player List UI loaded successfully!")
print("Dropdown will auto-update when players join/leave")
