-- Services
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- Player
local player = Players.LocalPlayer

-- Function to check for metatables
local function checkMetatable(t, name, indent)
    indent = indent or 0
    local mt = debug.getmetatable(t)
    if mt then
        print(string.rep("  ", indent) .. name .. " has a metatable:")
        for k, v in pairs(mt) do
            print(string.rep("  ", indent + 1) .. tostring(k) .. ": " .. tostring(v))
        end
    else
        print(string.rep("  ", indent) .. name .. " has no metatable.")
    end
end

-- Recursive function to print tables
local function inspectTable(t, name, indent)
    indent = indent or 0
    if type(t) ~= "table" then
        print(string.rep("  ", indent) .. name .. ": " .. tostring(t))
        return
    end

    -- Check for metatable
    checkMetatable(t, name, indent)

    -- Check if table is empty
    local isEmpty = true
    for k, v in pairs(t) do
        isEmpty = false
        break
    end

    if isEmpty then
        print(string.rep("  ", indent) .. name .. ": [EMPTY TABLE]")
    else
        print(string.rep("  ", indent) .. name .. ": [TABLE]")
        for k, v in pairs(t) do
            local formatting = string.rep("  ", indent + 1) .. tostring(k) .. ": "
            if type(v) == "table" then
                print(formatting .. "[TABLE]")
                inspectTable(v, k, indent + 2)
            else
                print(formatting .. tostring(v))
            end
        end
    end
end

-- Function to inspect pet_state_managers_raw in detail
local function inspectPetStateManagersRaw()
    print("üîç INSPECTING PET STATE MANAGERS RAW (FULL DEEP INSPECTION)")
    print("========================================================")

    -- Load client data
    local clientData = require(ReplicatedStorage.ClientModules.Core.ClientData)
    local data = clientData.get_data()[player.Name]

    if not data then
        print("No player data found.")
        return
    end

    if not data.pet_state_managers_raw then
        print("No pet_state_managers_raw data found.")
        return
    end

    -- Inspect each pet
    for petId, petState in pairs(data.pet_state_managers_raw) do
        print("Pet ID: " .. tostring(petId))
        for key, value in pairs(petState) do
            inspectTable(value, key, 1)
        end
        print("---")
    end
end

-- Run the inspection
inspectPetStateManagersRaw()
