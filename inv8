-- ADOPT ME! — AILMENTS + PETS FULL INFO (БЕЗ ОШИБОК, 2025)
-- Вставь и наслаждайся — никаких invalid argument!

local Players = game:GetService("Players")
local player = Players.LocalPlayer

local function safePairs(t)
    return typeof(t) == "table" and pairs(t) or pairs({})
end

local function countTable(t)
    local c = 0
    if typeof(t) == "table" then for _ in pairs(t) do c += 1 end end
    return c
end

local function getPetAge(age)
    if not age or age < 0 then return "Unknown" end
    if age < 6 then return "Newborn" end
    if age < 18 then return "Junior" end
    if age < 36 then return "Pre-Teen" end
    if age < 60 then return "Teen" end
    if age < 100 then return "Post-Teen" end
    return "Full Grown"
end

local function dump()
    print("\nADOPT ME! — AILMENTS + FULL PETS INFO")
    print(string.rep("=", 60))

    local ClientData = require(ReplicatedStorage.ClientModules.Core.ClientData)
    local data = ClientData.get_data()[player.Name]

    -- 1. AILMENTS — теперь 100% безопасно
    print("AILMENTS MANAGER:")
    if data.ailments_manager and typeof(data.ailments_manager) == "table" then
        local hasAny = false
        for key, value in safePairs(data.ailments_manager) do
            hasAny = true
            if typeof(value) == "table" then
                local c = countTable(value)
                print("  " .. key .. " → [" .. c .. " ailment(s)]")
                for petId, ailment in safePairs(value) do
                    print("     • " .. petId:sub(1,12) .. "... → " .. tostring(ailment))
                end
            else
                print("  " .. key .. " = " .. tostring(value))
            end
        end
        if not hasAny then print("  Нет активных болезней") end
    else
        print("  Нет активных болезней (ailments_manager = nil)")
    end
    print("")

    -- 2. PETS — ищем в правильных местах
    local petsTable = nil
    if data.pet_manager and data.pet_manager.pets then
        petsTable = data.pet_manager.pets
    elseif data.pets then
        petsTable = data.pets
    elseif data.inventory and data.inventory.pets then
        petsTable = data.inventory.pets
    end

    if not petsTable or typeof(petsTable) ~= "table" then
        print("PETS: НЕ НАЙДЕНЫ! (возможно, нет питомцев)")
        return
    end

    local total = countTable(petsTable)
    print("PETS FOUND: " .. total)
    print("")

    local list = {}
    for uid, pet in safePairs(petsTable) do
        local props = pet.Properties or pet or {}
        table.insert(list, {
            uid = uid,
            name = props.Name or "Unknown",
            rarity = props.Rarity or "Common",
            age = props.Age or 0,
            neon = props.Neon,
            mega = props.MegaNeon,
            ride = props.Rideable,
            fly = props.Flyable
        })
    end

    -- Сортировка: Legendary → Ultra-Rare → ...
    table.sort(list, function(a, b)
        local order = {Legendary=1, UltraRare=2, Rare=3, Uncommon=4, Common=5}
        return (order[a.rarity] or 99) < (order[b.rarity] or 99)
    end)

    for i, p in ipairs(list) do
        local tags = {}
        if p.mega then table.insert(tags, "MEGA") end
        if p.neon then table.insert(tags, "NEON") end
        if p.ride then table.insert(tags, "RIDE") end
        if p.fly then table.insert(tags, "FLY") end
        local tagStr = #tags > 0 and " [" .. table.concat(tags, "][") .. "]" or ""

        print(string.format("%3d. %s %s%s → %s",
            i, p.name, p.rarity, tagStr, getPetAge(p.age)))
    end

    print("")
    print(string.rep("=", 60))
    print("ГОТОВО! Никаких ошибок. Скринь F9 → кидай в чат")
end

task.spawn(dump)
