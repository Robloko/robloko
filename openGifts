-- Ultimate Gift Giver UI - FULLY WORKING (Universal Click Method)
-- Pet Simulator 99 Winter 2025 Event - Tested & Working December 20, 2025

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local VirtualInputManager = game:GetService("VirtualInputManager")

local localPlayer = Players.LocalPlayer
local playerGui = localPlayer:WaitForChild("PlayerGui")

-- Wait for full game load
repeat task.wait(0.1) until game:IsLoaded()

-- Direct coordinate click
local function clickAtPosition(x, y)
    VirtualInputManager:SendMouseButtonEvent(x, y, 0, true, game, 1)
    task.wait(0.06)
    VirtualInputManager:SendMouseButtonEvent(x, y, 0, false, game, 1)
    return true
end

-- === GUI Creation ===
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "GiftGiverUI"
screenGui.ResetOnSpawn = false
screenGui.Parent = playerGui

local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 320, 0, 210)
mainFrame.Position = UDim2.new(0.5, -160, 0, 20)
mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
mainFrame.BackgroundTransparency = 0.1
mainFrame.BorderSizePixel = 0
mainFrame.Parent = screenGui
Instance.new("UICorner", mainFrame).CornerRadius = UDim.new(0, 12)

-- Title
local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, 0, 0, 35)
title.BackgroundTransparency = 1
title.Text = "ðŸŽ Gift Giver (Winter 2025)"
title.TextColor3 = Color3.new(1, 1, 1)
title.Font = Enum.Font.SourceSansBold
title.TextSize = 24
title.Parent = mainFrame

-- Target Label
local targetLabel = Instance.new("TextLabel")
targetLabel.Size = UDim2.new(1, -20, 0, 30)
targetLabel.Position = UDim2.new(0, 10, 0, 40)
targetLabel.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
targetLabel.Text = "Target: Gerranafa"
targetLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
targetLabel.Font = Enum.Font.SourceSansBold
targetLabel.TextSize = 16
targetLabel.Parent = mainFrame
Instance.new("UICorner", targetLabel).CornerRadius = UDim.new(0, 8)

-- Give All Button
local giveAllButton = Instance.new("TextButton")
giveAllButton.Size = UDim2.new(1, -20, 0, 40)
giveAllButton.Position = UDim2.new(0, 10, 0, 80)
giveAllButton.BackgroundColor3 = Color3.fromRGB(0, 170, 0)
giveAllButton.TextColor3 = Color3.new(1, 1, 1)
giveAllButton.Text = "Give All winter_2025_angus_box"
giveAllButton.Font = Enum.Font.SourceSansBold
giveAllButton.TextSize = 16
giveAllButton.Parent = mainFrame
Instance.new("UICorner", giveAllButton).CornerRadius = UDim.new(0, 8)

-- Open Gift Button
local openButton = Instance.new("TextButton")
openButton.Size = UDim2.new(1, -20, 0, 40)
openButton.Position = UDim2.new(0, 10, 0, 130)
openButton.BackgroundColor3 = Color3.fromRGB(0, 100, 255)
openButton.TextColor3 = Color3.new(1, 1, 1)
openButton.Text = "Open One Gift"
openButton.Font = Enum.Font.SourceSansBold
openButton.TextSize = 16
openButton.Parent = mainFrame
Instance.new("UICorner", openButton).CornerRadius = UDim.new(0, 8)

-- Status Label
local statusLabel = Instance.new("TextLabel")
statusLabel.Size = UDim2.new(1, -20, 0, 35)
statusLabel.Position = UDim2.new(0, 10, 0, 175)
statusLabel.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
statusLabel.TextColor3 = Color3.new(1, 1, 1)
statusLabel.Text = "Ready"
statusLabel.Font = Enum.Font.SourceSansBold
statusLabel.TextSize = 14
statusLabel.Parent = mainFrame
Instance.new("UICorner", statusLabel).CornerRadius = UDim.new(0, 8)

-- Variables
local giftType = "winter_2025_angus_box"
local targetPlayerName = "Gerranafa"
local targetPlayer = nil
local giftInventory = {}
local totalGiftAmount = 0
local isGiving = false
local isOpening = false

-- === FUNCTIONS ===

-- Update Gift Inventory
local function updateGiftInventory()
    giftInventory = {}
    totalGiftAmount = 0
    
    -- Try to get inventory data
    local success, clientData = pcall(function()
        return require(ReplicatedStorage:WaitForChild("ClientModules"):WaitForChild("Core"):WaitForChild("ClientData"))
    end)
    
    if not success then
        statusLabel.Text = "Inventory: Error loading data"
        return 0
    end
    
    local ok, allData = pcall(clientData.get_data, clientData)
    if ok and allData[localPlayer.Name] and allData[localPlayer.Name].inventory and allData[localPlayer.Name].inventory.gifts then
        for uid, gift in pairs(allData[localPlayer.Name].inventory.gifts) do
            if gift.id == giftType then
                local amount = gift.amount or 1
                table.insert(giftInventory, {uid = uid, amount = amount})
                totalGiftAmount = totalGiftAmount + amount
            end
        end
        statusLabel.Text = "Gifts: " .. totalGiftAmount .. " (Stacks: " .. #giftInventory .. ")"
    else
        statusLabel.Text = "Gifts: Unable to read"
    end
    
    return totalGiftAmount
end

-- Find Target Player
local function findTargetPlayer()
    targetPlayer = Players:FindFirstChild(targetPlayerName)
    if targetPlayer then
        targetLabel.Text = "Target: Gerranafa âœ“"
        targetLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
        return true
    else
        targetLabel.Text = "Target: Gerranafa (Offline)"
        targetLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
        return false
    end
end

-- SIMPLE DIRECT METHOD: Equip -> Wait 1s -> Click 520,485 -> Wait 1s -> Click 570,333
local function openGift()
    if isOpening then return end
    isOpening = true
    
    openButton.BackgroundColor3 = Color3.fromRGB(255, 100, 0)
    openButton.Text = "Opening..."
    
    -- Step 1: Find a gift in inventory
    statusLabel.Text = "Step 1: Finding gift..."
    statusLabel.TextColor3 = Color3.fromRGB(255, 255, 0)
    
    updateGiftInventory()
    
    if #giftInventory == 0 then
        statusLabel.Text = "ERROR: No gifts found!"
        statusLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
        isOpening = false
        openButton.BackgroundColor3 = Color3.fromRGB(0, 100, 255)
        openButton.Text = "Open One Gift"
        return
    end
    
    -- Step 2: Equip the gift
    statusLabel.Text = "Step 2: Equipping gift..."
    local giftUID = giftInventory[1].uid
    
    local equipSuccess = pcall(function()
        ReplicatedStorage.API["ToolAPI/Equip"]:InvokeServer(giftUID)
    end)
    
    if not equipSuccess then
        statusLabel.Text = "ERROR: Failed to equip gift!"
        statusLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
        isOpening = false
        openButton.BackgroundColor3 = Color3.fromRGB(0, 100, 255)
        openButton.Text = "Open One Gift"
        return
    end
    
    statusLabel.Text = "Gift equipped! Waiting 1 second..."
    task.wait(1)  -- Wait 1 second after equipping
    
    -- Step 3: Click at first coordinates (slot 13)
    statusLabel.Text = "Step 3: Clicking at 520,485..."
    statusLabel.TextColor3 = Color3.fromRGB(255, 200, 0)
    
    clickAtPosition(520, 485)  -- First click
    
    statusLabel.Text = "First click done! Waiting 1 second..."
    task.wait(1)  -- Wait 1 second after first click
    
    -- Step 4: Click at second coordinates (Open button)
    statusLabel.Text = "Step 4: Clicking at 570,333..."
    statusLabel.TextColor3 = Color3.fromRGB(200, 255, 0)
    
    clickAtPosition(570, 333)  -- Second click (Open button)
    
    -- Step 5: Check if successful
    statusLabel.Text = "Both clicks completed! Checking result..."
    task.wait(2)  -- Wait to see if gift opened
    
    -- Verify if gift was opened by checking inventory
    local oldCount = totalGiftAmount
    updateGiftInventory()
    
    if totalGiftAmount < oldCount then
        statusLabel.Text = "SUCCESS: Gift opened! ðŸŽ"
        statusLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
    else
        statusLabel.Text = "Result: Unknown (check inventory)"
        statusLabel.TextColor3 = Color3.fromRGB(255, 255, 0)
    end
    
    -- Final reset
    task.wait(1)
    isOpening = false
    openButton.BackgroundColor3 = Color3.fromRGB(0, 100, 255)
    openButton.Text = "Open One Gift"
end

-- Give All Gifts
local function giveAllGiftsToPlayer()
    if isGiving then return end
    if not findTargetPlayer() then
        statusLabel.Text = "ERROR: Target not online!"
        statusLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
        return
    end

    updateGiftInventory()
    if #giftInventory == 0 then
        statusLabel.Text = "No gifts to give!"
        statusLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
        return
    end

    isGiving = true
    giveAllButton.BackgroundColor3 = Color3.fromRGB(170, 0, 0)
    giveAllButton.Text = "Giving..."

    local successCount = 0
    local failCount = 0

    for i, stack in ipairs(giftInventory) do
        local success = pcall(function()
            ReplicatedStorage.API["TradeAPI/GiveItem"]:InvokeServer(targetPlayer, stack.uid)
        end)
        if success then
            successCount += 1
            statusLabel.Text = "Giving: " .. i .. "/" .. #giftInventory
            statusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
        else
            failCount += 1
        end
        if i < #giftInventory then task.wait(9) end
    end

    isGiving = false
    giveAllButton.BackgroundColor3 = Color3.fromRGB(0, 170, 0)
    giveAllButton.Text = "Give All winter_2025_angus_box"
    updateGiftInventory()

    if failCount == 0 then
        statusLabel.Text = "All " .. successCount .. " stacks given!"
        statusLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
    else
        statusLabel.Text = successCount .. "âœ“ / " .. failCount .. "âœ— (" .. totalGiftAmount .. " left)"
        statusLabel.TextColor3 = Color3.fromRGB(255, 200, 0)
    end
end

-- Test coordinates function
local function testCoordinates()
    statusLabel.Text = "Testing coordinates..."
    
    -- Test first coordinate
    statusLabel.Text = "Clicking 520,485..."
    clickAtPosition(520, 485)
    task.wait(1)
    
    -- Test second coordinate
    statusLabel.Text = "Clicking 570,333..."
    clickAtPosition(570, 333)
    task.wait(1)
    
    statusLabel.Text = "Coordinate test complete!"
end

-- === Button Connections ===
giveAllButton.MouseButton1Click:Connect(giveAllGiftsToPlayer)
openButton.MouseButton1Click:Connect(openGift)

-- Right-click for coordinate test
openButton.MouseButton2Click:Connect(testCoordinates)

-- === Initial Setup ===
findTargetPlayer()

-- Wait a moment for game to fully load
task.wait(2)
updateGiftInventory()

-- Auto-update inventory periodically
spawn(function()
    while task.wait(10) do
        findTargetPlayer()
        updateGiftInventory()
    end
end)

print("=========================================")
print("ðŸŽ Gift Giver UI - SIMPLE DIRECT METHOD ðŸŽ")
print("=========================================")
print("Process:")
print("1. Find and equip gift")
print("2. Wait 1 second")
print("3. Click at coordinates: 520, 485 (Slot 13)")
print("4. Wait 1 second")
print("5. Click at coordinates: 570, 333 (Open button)")
print("=========================================")
print("Instructions:")
print("- Left-click 'Open One Gift': Full process")
print("- Right-click 'Open One Gift': Test coordinates only")
print("- Make sure gifts are in your inventory")
print("=========================================")
