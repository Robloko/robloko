local Tasks = {"hungry", "sleepy", "thirsty", "bored", "dirty", "camping", "sick", "school", "hot_spring", "salon", "pizza_party"}

local function resolveBabyAilments()
    print("Starting baby ailments resolver...")
    
    while true do
        task.wait(5) -- Wait 5 second between checks

        local success, err = pcall(function()
            -- Get the local player
            local Players = game:GetService("Players")
            local localPlayer = Players.LocalPlayer
            if not localPlayer then
                error("Local player not found")
            end
            
            print("Checking player:", localPlayer.Name)

            -- Check for required modules and objects
            local ReplicatedStorage = game:GetService("ReplicatedStorage")
            
            -- Check ClientModules
            local clientDataModule = ReplicatedStorage:FindFirstChild("ClientModules")
            if not clientDataModule then 
                error("ClientModules not found in ReplicatedStorage")
            end
            print("✓ Found ClientModules")

            -- Check Core module
            local coreModule = clientDataModule:FindFirstChild("Core")
            if not coreModule then 
                error("Core module not found in ClientModules")
            end
            print("✓ Found Core module")

            -- Load ClientData
            local clientDataScript = coreModule:WaitForChild("ClientData")
            if not clientDataScript then
                error("ClientData script not found in Core module")
            end
            
            local clientData = require(clientDataScript)
            if not clientData then 
                error("Failed to load ClientData module")
            end
            print("✓ Loaded ClientData")

            -- Get player data
            local allPlayerData = clientData.get_data()
            if not allPlayerData then
                error("Failed to get player data table")
            end
            
            local playerData = allPlayerData[localPlayer.Name]
            if not playerData then
                error("Failed to get data for player: " .. localPlayer.Name)
            end
            print("✓ Retrieved player data")

            -- Check ailments manager structure
            if not playerData.ailments_manager then
                error("ailments_manager not found in player data")
            end
            
            if not playerData.ailments_manager.baby_ailments then
                print("No baby ailments found - babies are healthy!")
                return
            end
            
            print("✓ Found baby ailments data structure")
            print("Baby ailments:", playerData.ailments_manager.baby_ailments)

            -- Check if there are any active baby ailments
            local hasActiveAilments = false
            for ailmentType, ailmentData in pairs(playerData.ailments_manager.baby_ailments) do
                -- Check if the ailment is actually active (not completed)
                if ailmentData and type(ailmentData) == "table" and ailmentData.completed ~= true then
                    hasActiveAilments = true
                    break
                end
            end
            
            if not hasActiveAilments then
                print("No active baby ailments found to resolve")
                return
            end

            -- Process baby ailments
            for ailmentType, ailmentData in pairs(playerData.ailments_manager.baby_ailments) do
                print("Checking ailment:", ailmentType, "Data:", ailmentData)
                
                -- Skip if ailment is already completed
                if ailmentData and type(ailmentData) == "table" and ailmentData.completed == true then
                    print("Skipping completed ailment:", ailmentType)
                    continue
                end
                
                if table.find(Tasks, ailmentType) then
                    print("Attempting to resolve ailment:", ailmentType)
                    
                    -- Use the correct AilmentsAPI instead of MonitorAPI
                    local completeAilment = ReplicatedStorage.API:FindFirstChild("AilmentsAPI/BabyAilmentCompleted")
                    if completeAilment then
                        print("✓ Found AilmentsAPI/BabyAilmentCompleted, firing...")
                        local success2, err2 = pcall(function()
                            completeAilment:FireServer(ailmentType)
                        end)
                        
                        if success2 then
                            print("✓ Successfully resolved baby ailment:", ailmentType)
                        else
                            warn("✗ Failed to fire AilmentsAPI for " .. ailmentType .. ": " .. tostring(err2))
                        end
                    else
                        -- Alternative: Try using AddAdditive if it exists elsewhere
                        local addAdditive = ReplicatedStorage.API:FindFirstChild("MonitorAPI/AddAdditive")
                        if addAdditive then
                            print("✓ Found MonitorAPI/AddAdditive as alternative, firing...")
                            local success2, err2 = pcall(function()
                                addAdditive:FireServer(ailmentType, 1)
                            end)
                            
                            if success2 then
                                print("✓ Successfully resolved baby ailment via AddAdditive:", ailmentType)
                            else
                                warn("✗ Failed to fire AddAdditive for " .. ailmentType .. ": " .. tostring(err2))
                            end
                        else
                            warn("✗ Neither AilmentsAPI/BabyAilmentCompleted nor MonitorAPI/AddAdditive found")
                        end
                    end
                else
                    print("Ailment not in Tasks list:", ailmentType)
                end
            end
        end)

        if not success then
            warn("Error in baby ailments resolver: " .. tostring(err))
        end
    end
end

-- Start the function
resolveBabyAilments()
