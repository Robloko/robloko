-- Services
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- Player
local player = Players.LocalPlayer

-- Debug function to explore the data structure
local function debugDataStructure()
    print("üîç DEBUGGING DATA STRUCTURE")
    print("============================")
    
    -- Try to require ClientData
    local success, clientData = pcall(require, ReplicatedStorage.ClientModules.Core.ClientData)
    if not success then
        print("‚ùå Failed to load ClientData module")
        print("   Path: ReplicatedStorage.ClientModules.Core.ClientData")
        return
    end
    print("‚úÖ ClientData module loaded successfully")
    
    -- Try to call get_data()
    local success2, playerData = pcall(clientData.get_data)
    if not success2 then
        print("‚ùå Failed to call get_data()")
        return
    end
    print("‚úÖ get_data() called successfully")
    
    -- Check if player data exists
    if not playerData then
        print("‚ùå playerData is nil")
        return
    end
    
    if not playerData[player.Name] then
        print("‚ùå No data found for player: " .. player.Name)
        print("   Available players in data:")
        for playerName, data in pairs(playerData) do
            print("   - " .. playerName .. " (" .. type(data) .. ")")
        end
        return
    end
    
    local data = playerData[player.Name]
    print("‚úÖ Found data for player: " .. player.Name)
    print("   Data type: " .. type(data))
    
    -- List all top-level keys
    local keyCount = 0
    local managerKeys = {}
    
    print("\nüìã ALL TOP-LEVEL KEYS:")
    for key, value in pairs(data) do
        keyCount = keyCount + 1
        local valueType = type(value)
        if string.find(string.lower(key), "manager") then
            table.insert(managerKeys, key)
            print("   üéØ " .. key .. " [" .. valueType .. "] - MANAGER")
        else
            print("   üìÑ " .. key .. " [" .. valueType .. "]")
        end
    end
    
    print("\nüìä SUMMARY:")
    print("   Total keys: " .. keyCount)
    print("   Manager keys: " .. #managerKeys)
    
    -- Now inspect the specific managers we're looking for
    local targetManagers = {
        "AILMENTS_MANAGER",
        "STATE_MANAGER_RAW", 
        "PET_STATE_MANAGERS",
        "ADMIN_ABUSE_MANAGER",
        "QUEST_MANAGER"
    }
    
    print("\nüéØ CHECKING SPECIFIC MANAGERS:")
    for _, managerName in ipairs(targetManagers) do
        if data[managerName] then
            local managerData = data[managerName]
            print("   ‚úÖ " .. managerName .. " - FOUND [" .. type(managerData) .. "]")
            
            if type(managerData) == "table" then
                local itemCount = 0
                for _ in pairs(managerData) do itemCount = itemCount + 1 end
                print("      Items: " .. itemCount)
                
                -- Show first 3 keys
                local count = 0
                for key, value in pairs(managerData) do
                    count = count + 1
                    if count <= 3 then
                        print("      - " .. key .. " [" .. type(value) .. "]")
                    end
                end
                if count > 3 then
                    print("      ... and " .. (count - 3) .. " more")
                end
            end
        else
            print("   ‚ùå " .. managerName .. " - NOT FOUND")
        end
    end
end

-- Alternative approach: Try different module paths
local function tryDifferentPaths()
    print("\nüîÑ TRYING DIFFERENT MODULE PATHS")
    print("================================")
    
    local possiblePaths = {
        "ReplicatedStorage.ClientModules.Core.ClientData",
        "ReplicatedStorage.Modules.Core.ClientData", 
        "ReplicatedStorage.ClientData",
        "ReplicatedStorage.Modules.ClientData",
        "ReplicatedStorage.Shared.ClientData",
        "ReplicatedStorage.Common.ClientData"
    }
    
    for _, path in ipairs(possiblePaths) do
        local parts = string.split(path, ".")
        local current = game
        local valid = true
        
        for i, part in ipairs(parts) do
            if current:FindFirstChild(part) then
                current = current[part]
            else
                valid = false
                break
            end
        end
        
        if valid then
            local success, module = pcall(require, current)
            if success then
                print("‚úÖ Found: " .. path)
                if type(module.get_data) == "function" then
                    print("   üìä Has get_data function!")
                    return module
                end
            end
        end
    end
    
    print("‚ùå No valid ClientData module found")
    return nil
end

-- Simple function to just list what's available
local function quickInspect()
    print("\n‚ö° QUICK INSPECT - ALL MANAGERS")
    print("===============================")
    
    local clientData = require(ReplicatedStorage.ClientModules.Core.ClientData)
    local playerData = clientData.get_data()
    
    if playerData and playerData[player.Name] then
        local data = playerData[player.Name]
        
        for key, value in pairs(data) do
            if string.find(string.lower(key), "manager") then
                print("üéØ " .. key .. ":")
                if type(value) == "table" then
                    local count = 0
                    for k, v in pairs(value) do
                        count = count + 1
                        print("   - " .. k .. " = " .. tostring(v) .. " [" .. type(v) .. "]")
                        if count >= 5 then
                            print("   ... (showing first 5 items)")
                            break
                        end
                    end
                else
                    print("   Value: " .. tostring(value))
                end
                print("   ---")
            end
        end
    end
end

-- Main execution
print("üöÄ STARTING DEBUG SESSION")
print("==========================")

-- First try the debug approach
debugDataStructure()

-- If that doesn't work, try alternative paths
-- tryDifferentPaths()

-- If you want a quick overview, uncomment this:
-- quickInspect()

print("\n‚úÖ DEBUG COMPLETE")
